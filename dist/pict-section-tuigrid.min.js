"use strict";function _defineProperty(t,e,i){return(e=_toPropertyKey(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PictSectionTuigrid=t()}}((function(){return function t(e,i,o){function n(s,a){if(!i[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=i[s]={exports:{}};e[s][0].call(l.exports,(function(t){return n(e[s][1][t]||t)}),l,l.exports,t,e,i,o)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({1:[function(t,e,i){class o{constructor(t,e){this.fable=!1,this.options="object"==typeof t?t:{},this.serviceType="Unknown",this.UUID="CORESVC-".concat(Math.floor(89999*Math.random()+1e4)),this.Hash="string"==typeof e?e:"".concat(this.UUID)}connectFable(t){return this.fable=t,!0}}_defineProperty(o,"isFableService",!0),e.exports=o},{}],2:[function(t,e,i){class o{constructor(t,e,i){this.fable=t,this.options="object"==typeof e?e:"object"!=typeof t||t.isFable?{}:t,this.serviceType="Unknown","function"==typeof t.getUUID?this.UUID=t.getUUID():this.UUID="NoFABLESVC-".concat(Math.floor(89999*Math.random()+1e4)),this.Hash="string"==typeof i?i:"".concat(this.UUID),this.log=this.fable.log,this.servicesMap=this.fable.serviceMap,this.services=this.fable.services}}_defineProperty(o,"isFableService",!0),e.exports=o,e.exports.CoreServiceProviderBase=t("./Fable-ServiceProviderBase-Preinit.js")},{"./Fable-ServiceProviderBase-Preinit.js":1}],3:[function(t,e,i){const o=t("fable-serviceproviderbase"),n={DefaultRenderable:!1,DefaultDestinationAddress:!1,DefaultTemplateRecordAddress:!1,ViewIdentifier:"DEFAULT",InitializeOnLoad:!0,RenderOnLoad:!1,Templates:[],DefaultTemplates:[],Renderables:[],Manifests:{}};e.exports=class extends o{constructor(t,e,i){super(t,Object.assign({},JSON.parse(JSON.stringify(n)),e),i),this.serviceType="PictView",this.AppData=this.fable.AppData;for(let t=0;t<this.options.Templates.length;t++){let e=this.options.Templates[t];e.hasOwnProperty("Hash")&&e.hasOwnProperty("Template")?(e.Source||(e.Source="PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," options object.")),this.fable.TemplateProvider.addTemplate(e.Hash,e.Template,e.Source)):this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not load Template ").concat(t," in the options array."),e)}for(let t=0;t<this.options.DefaultTemplates.length;t++){let e=this.options.DefaultTemplates[t];e.hasOwnProperty("Postfix")&&e.hasOwnProperty("Template")?(e.Source||(e.Source="PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," options object.")),this.fable.TemplateProvider.addDefaultTemplate(e.Prefix,e.Postfix,e.Template,e.Source)):this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not load Default Template ").concat(t," in the options array."),e)}this.renderables={};for(let t=0;t<this.options.Renderables.length;t++){let e=this.options.Renderables[t];e.hasOwnProperty("RenderableHash")&&e.hasOwnProperty("TemplateHash")?this.renderables[e.RenderableHash]=e:this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not load Renderable ").concat(t," in the options array."),e)}this.options.InitializeOnLoad&&this.initialize(),this.options.RenderOnLoad&&(this.render(this.options.DefaultRenderable,this.options.DefaultDestinationAddress,this.options.DefaultTemplateRecordAddress),this.postInitialRenderInitialize())}internalInitialize(){return!0}postInitialRenderInitialize(){return!0}initialize(){this.log.info("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," beginning initialization...")),this.internalInitialize(),this.log.info("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," initialization complete."))}render(t,e,i){let o="string"==typeof t?t:"string"==typeof this.options.DefaultRenderable&&this.options.DefaultRenderable;if(!o)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(o," (param ").concat(t,") because it is not a valid renderable.")),!1;let n=this.renderables[o];if(!n)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(o," (param ").concat(t,") because it does not exist.")),!1;let r="string"==typeof e?e:"string"==typeof n.ContentDestinationAddress?n.ContentDestinationAddress:"string"==typeof this.options.DefaultDestinationAddress&&this.options.DefaultDestinationAddress;if(!r)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(o," (param ").concat(t,") because it does not have a valid destination address.")),!1;let s="string"==typeof i?i:"string"==typeof n.RecordAddress?n.RecordAddress:"string"==typeof this.options.DefaultTemplateRecordAddress&&this.options.DefaultTemplateRecordAddress,a="string"==typeof s?this.fable.DataProvider.getDataByAddress(s):void 0,c=this.fable.parseTemplateByHash(n.TemplateHash,a);return this.fable.ContentAssignment.assignContent(r,c)}renderAsync(t,e,i,o){let n="string"==typeof t&&t;if(!n)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not asynchronously render ").concat(n," (param ").concat(t,"because it is not a valid renderable.")),o(Error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not asynchronously render ").concat(n," (param ").concat(t,"because it is not a valid renderable.")));let r=this.renderables[n];if(!r)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(n," (param ").concat(t,") because it does not exist.")),o(Error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(n," (param ").concat(t,") because it does not exist.")));let s="string"==typeof e?e:"string"==typeof r.ContentDestinationAddress?r.ContentDestinationAddress:"string"==typeof this.options.DefaultDestinationAddress&&this.options.DefaultDestinationAddress;if(!s)return this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render ").concat(n," (param ").concat(t,") because it does not have a valid destination address.")),o(Error("Could not render ".concat(n)));let a="string"==typeof i?i:"string"==typeof r.RecordAddress?r.RecordAddress:"string"==typeof this.options.DefaultTemplateRecordAddress&&this.options.DefaultTemplateRecordAddress,c="string"==typeof a?this.fable.DataProvider.getDataByAddress(a):void 0;this.fable.parseTemplateByHash(r.TemplateHash,c,((e,i)=>e?(this.log.error("PictView [".concat(this.UUID,"]::[").concat(this.Hash,"] ").concat(this.options.ViewIdentifier," could not render (asynchronously) ").concat(n," (param ").concat(t,") because it did not parse the template."),e),o(e)):(this.fable.ContentAssignment.assignContent(s,i),o(null,i))))}}},{"fable-serviceproviderbase":2}],4:[function(t,e,i){e.exports={RenderOnLoad:!0,GridWidth:"auto",GridRowHeight:40,GridBodyHeight:"auto",GridBodyMinHeight:130,GridColumnMinWidth:50,GridColumnWidthResizable:!0,GridColumnHeightResizable:!1,GridColumnFrozenCount:0,GridColumnFrozenBorderWidth:3,GridScrollX:!0,GridScrollY:!0,GridShowDummyRows:!1,GridDraggableRows:!1,GridSelectionUnit:"cell",DefaultRenderable:"TuiGrid-Wrap",DefaultDestinationAddress:"#TuiGrid-Container-Div",Templates:[{Hash:"TuiGrid-Container",Template:"\x3c!-- TuiGrid-Container Rendering Soon --\x3e"}],Renderables:[{RenderableHash:"TuiGrid-Wrap",TemplateHash:"TuiGrid-Container",DestinationAddress:"#TuiGrid-Container-Div"}],TargetElementAddress:"#TuiGrid-Container-Div",GridDataAddress:!1,GridData:[{idrecord:1,entity:"SampleEntity",name:"Record name 1",description:"description 1"},{idrecord:2,entity:"SampleEntity",name:"Record name 2",description:"description 2"},{idrecord:3,entity:"SampleEntity",name:"Record name 3",description:"description 3"},{idrecord:4,entity:"SampleEntity",name:"Record name 4",description:"description 4"},{idrecord:5,entity:"SampleEntity",name:"Record name 5",description:"description 5"},{idrecord:6,entity:"SampleEntity",name:"Record name 6",description:"description 6"},{idrecord:7,entity:"SampleEntity",name:"Record name 7",description:"description 7"},{idrecord:8,entity:"SampleEntity",name:"Record name 8",description:"description 8"},{idrecord:9,entity:"SampleEntity",name:"Record name 9",description:"description 9"}],ColumnsToSolveOnChange:{},TuiColumnSchema:[{header:"IDRecord",name:"idrecord",PictTriggerSolveOnChange:!0},{header:"Entity",name:"entity",PictTriggerSolveOnChange:!0},{header:"Name",name:"name",editor:"text"},{header:"Description",name:"description",editor:"text"}]}},{}],5:[function(t,e,i){const o=t("pict-view");e.exports=class extends o{constructor(e,i,o){super(e,Object.assign({},t("./Pict-Section-TuiGrid-DefaultConfiguration.json"),i),o),this._tuiGridPrototype=!1,this.tuiGrid=!1,this.customHeaders=t("./Pict-TuiGrid-Headers.js"),this.customEditors=t("./Pict-TuiGrid-Editors.js"),this.customFormatters=t("./Pict-TuiGrid-Formatters.js"),this.columnSchema=!1,this.targetElementAddress=!1,this.gridData=!1}connectTuiGridPrototype(t){if(void 0!==t)this._tuiGridPrototype=t;else{if(this.log.trace("PICT-TuiGrid No TuiGrid Prototype defined or explicitly set; looking for it in the window object."),"undefined"==typeof window)return this.log.error("PICT-TuiGrid No TuiGrid Prototype found in window.tuiGrid -- window object unavailable."),!1;if(void 0===window.tui||void 0===window.tui.Grid)return this.log.error("PICT-TuiGrid No TuiGrid Prototype found in window.tuiGrid."),!1;this.log.trace("PICT-TuiGrid Found TuiGrid Prototype in window.tuiGrid."),this.connectTuiGridPrototype(window.tui.Grid)}}changeHandler(t){let e=!1;for(let i=0;i<t.changes.length;i++){let o=t.instance.getValue(t.changes[i].rowKey,"entity"),n=t.instance.getValue(t.changes[i].rowKey,"idrecord");this.log.trace("Generic Change Handler for TuiGrid Fired, Entity ".concat(o," IDRecord ").concat(n," setting Column [").concat(t.changes[i].value,"] to new Value [").concat(t.changes[i].value,"]")),this.options.ColumnsToSolveOnChange.hasOwnProperty(t.changes[i].columnName)&&(e=!0)}e&&this.services.PictApplication.solve()}postInitialRenderInitialize(){if(this._tuiGridPrototype||this.connectTuiGridPrototype(),this.tuiGrid)return this.log.error("TuiGrid going to ".concat(this.options.TargetElementAddress," is already initialized!")),!1;if(this.options.GridDataAddress){let t=this.fable.manifest.getValueByHash(this.AppData,this.options.GridDataAddress);"object"!=typeof t?(this.log.error("Address for GridData [".concat(this.options.GridDataAddress,"] did not return an object; it was a ").concat(typeof t,".")),this.gridData=[]):this.gridData=JSON.parse(JSON.stringify(t))}else this.gridData=[];let t=this.services.ContentAssignment.getElement(this.options.TargetElementAddress);if(t.length<1)return this.log.error("Could not find target element [".concat(this.options.TargetElementAddress,"] for TuiGrid!  Rendering won't function properly.")),this.targetElement=!1,!1;this.targetElement=t[0],this.columnSchema=this.options.TuiColumnSchema;for(let t=0;t<this.columnSchema.length;t++){let e=this.columnSchema[t];if(e.PictTriggerSolveOnChange&&(this.options.ColumnsToSolveOnChange[e.name]=e),e.hasOwnProperty("formatter")&&this.customFormatters.hasOwnProperty(e.formatter)&&(e.formatter=this.customFormatters[e.formatter]),e.hasOwnProperty("editor")&&(e.editor.hasOwnProperty("type")&&"string"==typeof e.editor.type&&this.customEditors.hasOwnProperty(e.editor.type)&&(e.editor.type=this.customEditors[e.editor.type]),e.editor.hasOwnProperty("options")&&"object"==typeof e.editor.options&&e.editor.options.hasOwnProperty("listItems")&&"string"==typeof e.editor.options.listItems)){let t=this.fable.manifest.getValueByHash({AppData:this.AppData,Options:this.options},e.editor.options.listItems);"object"==typeof t?e.editor.options.listItems=t:(this.log.warn("Pict TuiGrid for column [".concat(e.name,"] had [").concat(e.editor.options.listItems,"] as a listItems address, but it didn't return an object.  It was a [").concat(typeof t,"].  Setting to empty list.")),e.editor.options.listItems=[])}}let e=this._tuiGridPrototype;this.tuiGrid=new e({data:this.gridData,el:this.targetElement,columns:this.columnSchema,usageStatistics:!1,scrollY:this.options.GridScrollY,columnOptions:{resizable:this.options.GridColumnWidthResizable}}),this.tuiGrid.on("afterChange",(t=>{this.changeHandler(t)}))}SetGridValue(t,e,i,o){if(void 0===i)return console.log("Could not set grid value [".concat(t,"] = [").concat(e,"] looked up by [").concat(o,"]::[").concat(i,"].  No valid lookup value!")),!1;if(this.tuiGrid){let n=this.tuiGrid.getData();for(let r=0;r<n.length;r++){n[r][o]==i&&this.tuiGrid.setValue(r,t,e)}}else this.log.warn("Could not set grid value [".concat(t,"] = [").concat(e,"] looked up by [").concat(o,"]::[").concat(i,"].  No valid grid!"))}SetGridValueByRowKey(t,e,i){if(void 0===i)return this.log.error("Could not set grid value [".concat(t,"] = [").concat(e,"] looked up by row key [").concat(i,"].  No valid row key!")),!1;this.tuiGrid?this.tuiGrid.setValue(i,t,e):this.log.warn("Could not set grid value [".concat(t,"] = [").concat(e,"] looked up by [").concat(pLookupColumn,"]::[").concat(pLookupValue,"].  No valid grid!"))}},e.exports.default_configuration=t("./Pict-Section-TuiGrid-DefaultConfiguration.json")},{"./Pict-Section-TuiGrid-DefaultConfiguration.json":4,"./Pict-TuiGrid-Editors.js":7,"./Pict-TuiGrid-Formatters.js":8,"./Pict-TuiGrid-Headers.js":9,"pict-view":3}],6:[function(t,e,i){e.exports=class{constructor(t){const e=document.createElement("input"),i=t.columnInfo.editor.options.decimalPrecision?t.columnInfo.editor.options.decimalPrecision:3;e.type="number",e.value=String(t.value),e.oninput=t=>{const e=parseFloat(t.target.value).toFixed(i).toString();e.length<parseFloat(t.target.value).toString().length&&(t.target.value=e)},this.Element=e}getElement(){return this.Element}getValue(){return this.Element.value}mounted(){this.Element.select()}}},{}],7:[function(t,e,i){const o={};o.EditorNumber=t("./Pict-TuiGrid-Editor-Number.js"),e.exports=o},{"./Pict-TuiGrid-Editor-Number.js":6}],8:[function(t,e,i){const o={FormatterTwoDigitNumber:t=>{let e=Number.parseFloat(t.value).toFixed(2);return isNaN(e)?"":e},FormatterCurrencyNumber:t=>{let e=o.FormatterTwoDigitNumber(t);return""==e?e:"$".concat(e)}};e.exports=o},{}],9:[function(t,e,i){const o={};o.CustomColumnHeaderNone=class{constructor(){let t=document.createElement("input");t.type="hidden",t.value="",this.Element=t}getElement(){return this.Element}render(){}},e.exports=o},{}]},{},[5])(5)}));
//# sourceMappingURL=pict-section-tuigrid.min.js.map
